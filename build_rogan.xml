<?xml version="1.0" encoding="UTF-8"?>
<project basedir="." default="run" name="WebScarab">
        <target name="init">
        	<taskdef name="vainstall" classname="com.memoire.vainstall.ant.VAInstallTask" classpath="lib/vainstall.jar" />
                <tstamp/>
		<property name="jarname" value="webscarab.jar"/>
		<property name="source" value="src"/>
		<property name="classes" value="classes"/>
		<property name="mainclass" value="org.owasp.webscarab.ui.swing.WebScarab"/>
             	<property name="ocljar" value="lib/owasp.jar"/>
             	<property name="junitjar" value="lib/junit-3.7.jar"/>
             	<property name="htmlparserjar" value="lib/htmlparser.jar"/>
       		<path id="cpath">
			<pathelement location="./classes/"/>
			<pathelement path="${ocljar}"/>
                        <pathelement path="${junitjar}"/>
                        <pathelement path="${htmlparserjar}"/>
		</path>
	</target>
	<target depends="init" name="clean">
		<delete dir="${classes}"/>
                <delete file="${jarname}"/>
                <delete file="${vainstall.archive.installClassName}.jar"/>
		<delete verbose="on">
			<fileset dir="${source}" includes="**/*~"/>
			<fileset dir="${source}" includes="**/*.class"/>
		</delete>
	</target>
	<target depends="init" name="prepare">
		<mkdir dir="${classes}"/>
	</target>
	<target depends="prepare" name="compile">
		<javac classpathref="cpath" compiler="extJavac" deprecation="off" destdir="${classes}" excludes="**/test/**" optimize="on" srcdir="${source}"/>
	</target>
	<target depends="compile" name="build">
                <mkdir dir="${classes}/lib/"/>
                <copy file="serverkeys" todir="${classes}"/>
		<jar basedir="${classes}" jarfile="${jarname}">
                    <manifest>
                        <attribute name="Main-Class" value="${mainclass}"/>
                        <attribute name="Class-Path" value="lib/owasp.jar lib/htmlparser.jar"/>
                    </manifest>
                </jar>
                <echo message="${DSTAMP}-${TSTAMP}" file="timestamp"/>
	</target>
	<target depends="compile" name="run">
		<java classname="${mainclass}" classpathref="cpath" fork="on">
		</java>
	</target>
        <target name="installer" depends="build">
                <!-- this does not work currently as an ant task, but it does from the shell 
                     HELP?  In the mean time, use the shell script
                -->
                <property name="vainstall.archive.license" value="${basedir}/LICENSE"/>
                <property name="vainstall.archive.readme" value="${basedir}/README"/>
                <property name="vainstall.destination.appVersion" value="${DSTAMP}-${TSTAMP}"/>
                <property file="webscarab.vai" />
                <vainstall>
                        <fileset file="${jarname}"/>
                        <fileset dir="lib" includes="**/owasp.jar"/>
                        <fileset dir="lib" includes="**/htmlparser.jar"/>
                        <javalauncher scriptname="webscarab"
                                javaclass="${mainclass}"
                                classpath="${jarname}"
                                />
                </vainstall>
        </target>

</project>
