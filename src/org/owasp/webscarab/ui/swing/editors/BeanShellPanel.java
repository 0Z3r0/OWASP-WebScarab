/*
 * BeanShellPanel.java
 *
 * Created on November 6, 2003, 7:26 AM
 */

package org.owasp.webscarab.ui.swing.editors;

import org.owasp.webscarab.model.Request;
import org.owasp.webscarab.model.Response;

import bsh.util.JConsole;
import bsh.Interpreter;

/** Provides a console in which BeanShell (www.beanshell.org) scripts can be run.
 * @author rdawes
 */
public class BeanShellPanel extends javax.swing.JPanel {
    
    private JConsole _console;
    private Interpreter _interpreter;
    
    /** Creates new form BeanShellPanel */
    public BeanShellPanel() {
        initComponents();
        _console = new JConsole();
        _interpreter = new Interpreter( _console );
        
        new Thread( _interpreter ).start(); // start a thread to call the run() method
        beanPanel.add(_console);
    }
    
    /**
     * used to make Java objects available to the BeanShell interpreter
     * Realise that any modifications made are made to the original object
     * NOT a copy! Be careful what you do in the interpreter!
     * Consider things like synchronization, etc
     */
    public void setVariable(String name, Object object) throws bsh.EvalError{
        _interpreter.set(name , object);
    }

    /** This method is called from within the constructor to
     * initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is
     * always regenerated by the Form Editor.
     */
    private void initComponents() {//GEN-BEGIN:initComponents
        java.awt.GridBagConstraints gridBagConstraints;

        jLabel1 = new javax.swing.JLabel();
        scriptComboBox = new javax.swing.JComboBox();
        loadButton = new javax.swing.JButton();
        beanPanel = new javax.swing.JPanel();

        setLayout(new java.awt.GridBagLayout());

        jLabel1.setText("Load script ");
        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 0;
        gridBagConstraints.gridy = 0;
        gridBagConstraints.insets = new java.awt.Insets(4, 4, 4, 4);
        add(jLabel1, gridBagConstraints);

        scriptComboBox.setEditable(true);
        scriptComboBox.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                scriptComboBoxActionPerformed(evt);
            }
        });

        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 1;
        gridBagConstraints.gridy = 0;
        gridBagConstraints.fill = java.awt.GridBagConstraints.HORIZONTAL;
        gridBagConstraints.insets = new java.awt.Insets(4, 4, 4, 4);
        gridBagConstraints.weightx = 1.0;
        add(scriptComboBox, gridBagConstraints);

        loadButton.setText("Browse");
        loadButton.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                loadButtonActionPerformed(evt);
            }
        });

        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 2;
        gridBagConstraints.gridy = 0;
        gridBagConstraints.insets = new java.awt.Insets(4, 4, 4, 4);
        add(loadButton, gridBagConstraints);

        beanPanel.setLayout(new java.awt.BorderLayout());

        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 0;
        gridBagConstraints.gridy = 1;
        gridBagConstraints.gridwidth = java.awt.GridBagConstraints.REMAINDER;
        gridBagConstraints.fill = java.awt.GridBagConstraints.BOTH;
        gridBagConstraints.weightx = 1.0;
        gridBagConstraints.weighty = 1.0;
        add(beanPanel, gridBagConstraints);

    }//GEN-END:initComponents

    private void loadButtonActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_loadButtonActionPerformed
        System.out.println("loadButton pressed");
    }//GEN-LAST:event_loadButtonActionPerformed

    private void scriptComboBoxActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_scriptComboBoxActionPerformed
        if (evt.getActionCommand().equals("comboBoxChanged")) {
            System.err.println("Should try to load " + ((javax.swing.JComboBox)evt.getSource()).getSelectedItem());
        } else if (evt.getActionCommand().equals("comboBoxEdited")) {
            System.err.println("Should add " + ((javax.swing.JComboBox)evt.getSource()).getSelectedItem() + " to the history");
        }
    }//GEN-LAST:event_scriptComboBoxActionPerformed

    public static void main(String[] args) {
        javax.swing.JFrame top = new javax.swing.JFrame("BeanShell Pane");
        top.addWindowListener(new java.awt.event.WindowAdapter() {
            public void windowClosing(java.awt.event.WindowEvent evt) {
                System.exit(0);
            }
        });
        
        BeanShellPanel bsp = new BeanShellPanel();
        top.getContentPane().add(bsp);
        top.setBounds(100,100,600,400);
        top.show();
        try {
            java.util.ArrayList a = new java.util.ArrayList();
            a.add(new String("a string"));
            bsp.setVariable("a", a);
            Thread.currentThread().sleep(15000);
            System.err.println("ArrayList : " + a);
        } catch (Exception e) {
            e.printStackTrace();
        }
    }
    
    // Variables declaration - do not modify//GEN-BEGIN:variables
    private javax.swing.JPanel beanPanel;
    private javax.swing.JLabel jLabel1;
    private javax.swing.JButton loadButton;
    private javax.swing.JComboBox scriptComboBox;
    // End of variables declaration//GEN-END:variables
    
}
