<?xml version="1.0" encoding="UTF-8"?>

<!--
    Document   : Test.xml
    Created on : March 31, 2004, 5:40 PM
    Author     : knoppix
    Description:
        Purpose of the document follows.
-->

<Test timeout="30000">
    <Step id="0" message="getting cookie">
        <Request reuse="false" delay="1000" mayauth="true">
            <Method>GET</Method>
            <URL>${scheme}://${host}:${port}/index.html</URL>
            <Version>HTTP/1.0</Version>
            <Header name="Host">${host}</Header>
        </Request>
        <Response>
            <SetVar name="status" location="statusline">^(\d\d\d)</SetVar>
            <SetVar name="statusclass" location="statusline">^(\d)\d\d</SetVar>
            <SetVar name="cookie" header="Set-Cookie">JSESSIONID=(\w+)[; ]</SetVar>
        </Response>
        <Decide action="stoptest" log="error">
            <Message>index page not found. Could not get a cookie!</Message>
            <Compare variable="is404" operation="equals">true</Compare>
            <!-- is404 is an implied variable, set by the engine when the page is retrieved -->
            <Compare variable="statusclass" operation="equals">4</Compare>
            <Compare variable="statusclass" operation="equals">5</Compare>
        </Decide>
    </Step>
    <ThreadGroup>
        <Thread>
            <Step id="1" message="logging in">
                <Request reuse="false" delay="1000" mayauth="true">
                    <Method>POST</Method>
                    <URL>${scheme}://${host}:${port}${path}</URL>
                    <Version>HTTP/1.0</Version>
                    <Header name="Host">${host}</Header>
                    <Header name="Cookie">JSESSIONID=${cookie}</Header>
                    <Body length="auto" encoding="text">a=1&b=2</Body>
                </Request>
                <Response>
                    <SetVar name="status" location="statusline">^(\d\d\d)</SetVar>
                    <SetVar name="ctype" header="Content-Type">^(.*)$</SetVar>
                </Response>
                <Decide action="stoptest" log="none">
                    <Compare variable="is404" operation="equals"></Compare>
                    <!-- is404 is an implied variable, set by the engine when the page is retrieved -->
                </Decide>
                <Decide action="stoptest" log="vuln">
                    <Message>Vulnerability detected for URL ${scheme}://${host}:${port}${path}</Message>
                    <Compare variable="status" operation="equal">200</Compare>
                </Decide>
                <Decide action="stopiteration" log="error">
                    <Message>Test failed to execute correctly, due to the server requiring authentication for ${scheme}://${host}:${port}${path}</Message>
                    <Compare variable="status" operation="equals">401</Compare>
                </Decide>
                <Decide action="continue" log="none"></Decide>
            </Step>
        </Thread>
        <Thread>
            <Step id="2" message="a simultaneous request">
                <Request>
                </Request>
                <Response>
                </Response>
                <Decide></Decide>
            </Step>
        </Thread>
        <Decide action="continue" log="none">
        </Decide>
    </ThreadGroup>
    <Step id="3" message="abusing session">
        <Request>
        </Request>
        <Response>
        </Response>
        <Decide></Decide>
    </Step>
</Test>
<!-- 
Actions to perform while running a test:

Stop this iteration, no vuln found -> no report
Stop this Test, no Vuln Found -> no report
Stop this iteration, Vuln found -> report
Stop this test, Vuln found -> report
Stop this iteration, Error in processing -> log/alert
Stop this test, Error in processing -> log/alert
Continue to next step -> implies 1 if no more steps


-->